#!/bin/bash

LOCAL_SERVER=192.168.86.10
LOCAL_FINGER=a8:a1:59:9f:0c:b2
LOCAL=$(sudo arp-scan $LOCAL_SERVER | awk -e '{ print $2; }' | grep -e $LOCAL_FINGER)
if [ -n "$LOCAL" ]; then
  ADDR=$LOCAL_SERVER
  PORT=22
else
  ADDR=home.igster.org
  PORT=2222
fi

RUNNING=`pgrep -a rsync | grep $ADDR`
if [ -n "$RUNNING" ]; then
  exit 0
fi
echo $ADDR
export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh
rsync -azz -e "ssh -p $PORT" -F --delete --exclude=.cache /home $ADDR:/media/backup/laptop
rsync -azz -e "ssh -p $PORT" --delete /etc $ADDR:/media/backup/laptop
rsync -azz -e "ssh -p $PORT" --delete /usr/local $ADDR:/media/backup/laptop
rsync -azz -e "ssh -p $PORT" -F --delete /media $ADDR:/media/backup/laptop
rsync -azz -e "ssh -p $PORT" --delete /var/lib/pacman $ADDR:/media/backup/laptop
